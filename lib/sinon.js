/*!
 * Sinon.JS 1.5.2, 2012/11/27
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @author Contributors: https://github.com/cjohansen/Sinon.JS/blob/master/AUTHORS
 *
 * (The BSD License)
 *
 * Copyright (c) 2010-2012, Christian Johansen, christian@cjohansen.no
 * All rights reserved.
 */var sinon=function(){"use strict";var buster=function(e,t){var n=typeof require=="function"&&typeof module=="object";var r=typeof document!="undefined"&&document.createElement("div");var i=function(){};var s={bind:function(t,n){var r=typeof n=="string"?t[n]:n;var i=Array.prototype.slice.call(arguments,2);return function(){var e=i.concat(Array.prototype.slice.call(arguments));return r.apply(t,e)}},partial:function(t){var n=[].slice.call(arguments,1);return function(){return t.apply(this,n.concat([].slice.call(arguments)))}},create:function(t){i.prototype=t;return new i},extend:function(t){if(!t){return}for(var n=1,r=arguments.length,i;n<r;++n){for(i in arguments[n]){t[i]=arguments[n][i]}}return t},nextTick:function(n){if(typeof process!="undefined"&&process.nextTick){return process.nextTick(n)}e(n,0)},functionName:function(t){if(!t)return"";if(t.displayName)return t.displayName;if(t.name)return t.name;var n=t.toString().match(/function\s+([^\(]+)/m);return n&&n[1]||""},isNode:function(t){if(!r)return false;try{t.appendChild(r);t.removeChild(r)}catch(n){return false}return true},isElement:function(t){return t&&t.nodeType===1&&s.isNode(t)},isArray:function(t){return Object.prototype.toString.call(t)=="[object Array]"},flatten:function a(e){var t=[],e=e||[];for(var n=0,r=e.length;n<r;++n){t=t.concat(s.isArray(e[n])?a(e[n]):e[n])}return t},each:function(t,n){for(var r=0,i=t.length;r<i;++r){n(t[r])}},map:function(t,n){var r=[];for(var i=0,s=t.length;i<s;++i){r.push(n(t[i]))}return r},parallel:function(t,n){function r(e,t){if(typeof n=="function"){n(e,t);n=null}}function o(e){return function(n,o){if(n){return r(n)}s[e]=o;if(--i==0){r(null,s)}}}if(t.length==0){return r(null,[])}var i=t.length,s=[];for(var u=0,a=t.length;u<a;++u){t[u](o(u))}},series:function(t,n){function r(e,t){if(typeof n=="function"){n(e,t)}}function u(){if(i.length==0)return r(null,o);var e=i.shift()(a);if(e&&typeof e.then=="function"){e.then(s.partial(a,null),a)}}function a(e,t){if(e)return r(e);o.push(t);u()}var i=t.slice();var o=[];u()},countdown:function(t,n){return function(){if(--t==0)n()}}};if(typeof process==="object"&&typeof require==="function"&&typeof module==="object"){var o=require("crypto");var u=require("path");s.tmpFile=function(e){var t=o.createHash("sha1");t.update(e);var n=t.digest("hex");if(process.platform=="win32"){return u.join(process.env["TEMP"],n)}else{return u.join("/tmp",n)}}}if(Array.prototype.some){s.some=function(e,t,n){return e.some(t,n)}}else{s.some=function(e,t,n){if(e==null){throw new TypeError}e=Object(e);var r=e.length>>>0;if(typeof t!=="function"){throw new TypeError}for(var i=0;i<r;i++){if(e.hasOwnProperty(i)&&t.call(n,e[i],i,e)){return true}}return false}}if(Array.prototype.filter){s.filter=function(e,t,n){return e.filter(t,n)}}else{s.filter=function(e,t){if(this==null){throw new TypeError}var n=Object(this);var r=n.length>>>0;if(typeof e!="function"){throw new TypeError}var i=[];for(var s=0;s<r;s++){if(s in n){var o=n[s];if(e.call(t,o,s,n)){i.push(o)}}}return i}}if(n){module.exports=s;s.eventEmitter=require("./buster-event-emitter");Object.defineProperty(s,"defineVersionGetter",{get:function(){return require("./define-version-getter")}})}return s.extend(t||{},s)}(setTimeout,buster);if(typeof buster==="undefined"){var buster={}}if(typeof module==="object"&&typeof require==="function"){buster=require("buster-core")}buster.format=buster.format||{};buster.format.excludeConstructors=["Object",/^.$/];buster.format.quoteStrings=true;buster.format.ascii=function(){function n(t){var n=Object.keys&&Object.keys(t)||[];if(n.length==0){for(var r in t){if(e.call(t,r)){n.push(r)}}}return n.sort()}function r(e,t){if(typeof e!="object"){return false}for(var n=0,r=t.length;n<r;++n){if(t[n]===e){return true}}return false}function i(e,n,s){if(typeof e=="string"){var o=typeof this.quoteStrings!="boolean"||this.quoteStrings;return n||o?'"'+e+'"':e}if(typeof e=="function"&&!(e instanceof RegExp)){return i.func(e)}n=n||[];if(r(e,n)){return"[Circular]"}if(Object.prototype.toString.call(e)=="[object Array]"){return i.array.call(this,e,n)}if(!e){return""+e}if(buster.isElement(e)){return i.element(e)}if(typeof e.toString=="function"&&e.toString!==Object.prototype.toString){return e.toString()}for(var u=0,a=t.length;u<a;u++){if(e===t[u].obj){return t[u].value}}return i.object.call(this,e,n,s)}var e=Object.prototype.hasOwnProperty;var t=[];if(typeof global!="undefined"){t.push({obj:global,value:"[object global]"})}if(typeof document!="undefined"){t.push({obj:document,value:"[object HTMLDocument]"})}if(typeof window!="undefined"){t.push({obj:window,value:"[object Window]"})}i.func=function(e){return"function "+buster.functionName(e)+"() {}"};i.array=function(e,t){t=t||[];t.push(e);var n=[];for(var r=0,s=e.length;r<s;++r){n.push(i.call(this,e[r],t))}return"["+n.join(", ")+"]"};i.object=function(e,t,s){t=t||[];t.push(e);s=s||0;var o=[],u=n(e),a,f,l;var c="";var h=3;for(var p=0,d=s;p<d;++p){c+=" "}for(p=0,d=u.length;p<d;++p){a=u[p];l=e[a];if(r(l,t)){f="[Circular]"}else{f=i.call(this,l,t,s+2)}f=(/\s/.test(a)?'"'+a+'"':a)+": "+f;h+=f.length;o.push(f)}var v=i.constructorName.call(this,e);var m=v?"["+v+"] ":"";return h+s>80?m+"{\n  "+c+o.join(",\n  "+c)+"\n"+c+"}":m+"{ "+o.join(", ")+" }"};i.element=function(e){var t=e.tagName.toLowerCase();var n=e.attributes,r,i=[],s;for(var o=0,u=n.length;o<u;++o){r=n.item(o);s=r.nodeName.toLowerCase().replace("html:","");if(s=="contenteditable"&&r.nodeValue=="inherit"){continue}if(!!r.nodeValue){i.push(s+'="'+r.nodeValue+'"')}}var a="<"+t+(i.length>0?" ":"");var f=e.innerHTML;if(f.length>20){f=f.substr(0,20)+"[...]"}var l=a+i.join(" ")+">"+f+"</"+t+">";return l.replace(/ contentEditable="inherit"/,"")};i.constructorName=function(e){var t=buster.functionName(e&&e.constructor);var n=this.excludeConstructors||buster.format.excludeConstructors||[];for(var r=0,i=n.length;r<i;++r){if(typeof n[r]=="string"&&n[r]==t){return""}else if(n[r].test&&n[r].test(t)){return""}}return t};return i}();if(typeof module!="undefined"){module.exports=buster.format}var sinon=function(e){function r(e){var n=false;try{e.appendChild(t);n=t.parentNode==e}catch(r){return false}finally{try{e.removeChild(t)}catch(r){}}return n}function i(e){return t&&e&&e.nodeType===1&&r(e)}function s(e){return typeof e==="function"||!!(e&&e.constructor&&e.call&&e.apply)}function o(e,t){for(var r in t){if(!n.call(e,r)){e[r]=t[r]}}}var t=typeof document!="undefined"&&document.createElement("div");var n=Object.prototype.hasOwnProperty;var u={wrapMethod:function(t,r,i){if(!t){throw new TypeError("Should wrap property of object")}if(typeof i!="function"){throw new TypeError("Method wrapper should be function")}var u=t[r];if(!s(u)){throw new TypeError("Attempted to wrap "+typeof u+" property "+r+" as function")}if(u.restore&&u.restore.sinon){throw new TypeError("Attempted to wrap "+r+" which is already wrapped")}if(u.calledBefore){var a=!!u.returns?"stubbed":"spied on";throw new TypeError("Attempted to wrap "+r+" which is already "+a)}var f=n.call(t,r);t[r]=i;i.displayName=r;i.restore=function(){if(!f){delete t[r]}if(t[r]===i){t[r]=u}};i.restore.sinon=true;o(i,u);return i},extend:function(t){for(var n=1,r=arguments.length;n<r;n+=1){for(var i in arguments[n]){if(arguments[n].hasOwnProperty(i)){t[i]=arguments[n][i]}if(arguments[n].hasOwnProperty("toString")&&arguments[n].toString!=t.toString){t.toString=arguments[n].toString}}}return t},create:function(t){var n=function(){};n.prototype=t;return new n},deepEqual:function h(e,t){if(u.match&&u.match.isMatcher(e)){return e.test(t)}if(typeof e!="object"||typeof t!="object"){return e===t}if(i(e)||i(t)){return e===t}if(e===t){return true}if(e===null&&t!==null||e!==null&&t===null){return false}var n=Object.prototype.toString.call(e);if(n!=Object.prototype.toString.call(t)){return false}if(n=="[object Array]"){if(e.length!==t.length){return false}for(var r=0,s=e.length;r<s;r+=1){if(!h(e[r],t[r])){return false}}return true}var o,a=0,f=0;for(o in e){a+=1;if(!h(e[o],t[o])){return false}}for(o in t){f+=1}if(a!=f){return false}return true},functionName:function(t){var n=t.displayName||t.name;if(!n){var r=t.toString().match(/function ([^\s\(]+)/);n=r&&r[1]}return n},functionToString:function p(){if(this.getCall&&this.callCount){var e,t,n=this.callCount;while(n--){e=this.getCall(n).thisValue;for(t in e){if(e[t]===this){return t}}}}return this.displayName||"sinon fake"},getConfig:function(e){var t={};e=e||{};var n=u.defaultConfig;for(var r in n){if(n.hasOwnProperty(r)){t[r]=e.hasOwnProperty(r)?e[r]:n[r]}}return t},format:function(e){return""+e},defaultConfig:{injectIntoThis:true,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:true,useFakeServer:true},timesInWords:function(t){return t==1&&"once"||t==2&&"twice"||t==3&&"thrice"||(t||0)+" times"},calledInOrder:function(e){for(var t=1,n=e.length;t<n;t++){if(!e[t-1].calledBefore(e[t])){return false}}return true},orderByFirstCall:function(e){return e.sort(function(e,t){var n=e.getCall(0);var r=t.getCall(0);var i=n&&n.callId||-1;var s=r&&r.callId||-1;return i<s?-1:1})},log:function(){},logError:function(e,t){var n=e+" threw exception: ";u.log(n+"["+t.name+"] "+t.message);if(t.stack){u.log(t.stack)}setTimeout(function(){t.message=n+t.message;throw t},0)},typeOf:function(e){if(e===null){return"null"}else if(e===undefined){return"undefined"}var t=Object.prototype.toString.call(e);return t.substring(8,t.length-1).toLowerCase()}};var a=typeof module=="object"&&typeof require=="function";if(a){try{e={format:require("buster-format")}}catch(f){}module.exports=u;module.exports.spy=require("./sinon/spy");module.exports.stub=require("./sinon/stub");module.exports.mock=require("./sinon/mock");module.exports.collection=require("./sinon/collection");module.exports.assert=require("./sinon/assert");module.exports.sandbox=require("./sinon/sandbox");module.exports.test=require("./sinon/test");module.exports.testCase=require("./sinon/test_case");module.exports.assert=require("./sinon/assert");module.exports.match=require("./sinon/match")}if(e){var l=u.create(e.format);l.quoteStrings=false;u.format=function(){return l.ascii.apply(l,arguments)}}else if(a){try{var c=require("util");u.format=function(e){return typeof e=="object"&&e.toString===Object.prototype.toString?c.inspect(e):e}}catch(f){}}return u}(typeof buster=="object"&&buster);(function(e){function n(t,n,r){var i=e.typeOf(t);if(i!==n){throw new TypeError("Expected type of "+r+" to be "+n+", but was "+i)}}function i(e){return r.isPrototypeOf(e)}function s(t,n){if(n===null||n===undefined){return false}for(var r in t){if(t.hasOwnProperty(r)){var i=t[r];var u=n[r];if(o.isMatcher(i)){if(!i.test(u)){return false}}else if(e.typeOf(i)==="object"){if(!s(i,u)){return false}}else if(!e.deepEqual(i,u)){return false}}}return true}function u(t,r){return function(i,s){n(i,"string","property");var u=arguments.length===1;var a=r+'("'+i+'"';if(!u){a+=", "+s}a+=")";return o(function(n){if(n===undefined||n===null||!t(n,i)){return false}return u||e.deepEqual(s,n[i])},a)}}var t=typeof module=="object"&&typeof require=="function";if(!e&&t){e=require("../sinon")}if(!e){return}var r={toString:function(){return this.message}};r.or=function(t){if(!i(t)){throw new TypeError("Matcher expected")}var n=this;var s=e.create(r);s.test=function(e){return n.test(e)||t.test(e)};s.message=n.message+".or("+t.message+")";return s};r.and=function(t){if(!i(t)){throw new TypeError("Matcher expected")}var n=this;var s=e.create(r);s.test=function(e){return n.test(e)&&t.test(e)};s.message=n.message+".and("+t.message+")";return s};var o=function(t,n){var i=e.create(r);var o=e.typeOf(t);switch(o){case"object":if(typeof t.test==="function"){i.test=function(e){return t.test(e)===true};i.message="match("+e.functionName(t.test)+")";return i}var u=[];for(var a in t){if(t.hasOwnProperty(a)){u.push(a+": "+t[a])}}i.test=function(e){return s(t,e)};i.message="match("+u.join(", ")+")";break;case"number":i.test=function(e){return t==e};break;case"string":i.test=function(e){if(typeof e!=="string"){return false}return e.indexOf(t)!==-1};i.message='match("'+t+'")';break;case"regexp":i.test=function(e){if(typeof e!=="string"){return false}return t.test(e)};break;case"function":i.test=t;if(n){i.message=n}else{i.message="match("+e.functionName(t)+")"}break;default:i.test=function(n){return e.deepEqual(t,n)}}if(!i.message){i.message="match("+t+")"}return i};o.isMatcher=i;o.any=o(function(){return true},"any");o.defined=o(function(e){return e!==null&&e!==undefined},"defined");o.truthy=o(function(e){return!!e},"truthy");o.falsy=o(function(e){return!e},"falsy");o.same=function(e){return o(function(t){return e===t},"same("+e+")")};o.typeOf=function(t){n(t,"string","type");return o(function(n){return e.typeOf(n)===t},'typeOf("'+t+'")')};o.instanceOf=function(t){n(t,"function","type");return o(function(e){return e instanceof t},"instanceOf("+e.functionName(t)+")")};o.has=u(function(e,t){if(typeof e==="object"){return t in e}return e[t]!==undefined},"has");o.hasOwn=u(function(e,t){return e.hasOwnProperty(t)},"hasOwn");o.bool=o.typeOf("boolean");o.number=o.typeOf("number");o.string=o.typeOf("string");o.object=o.typeOf("object");o.func=o.typeOf("function");o.array=o.typeOf("array");o.regexp=o.typeOf("regexp");o.date=o.typeOf("date");if(t){module.exports=o}else{e.match=o}})(typeof sinon=="object"&&sinon||null);(function(sinon){function spy(e,t){if(!t&&typeof e=="function"){return spy.create(e)}if(!e&&!t){return spy.create(function(){})}var n=e[t];return sinon.wrapMethod(e,t,spy.create(n))}var commonJSModule=typeof module=="object"&&typeof require=="function";var spyCall;var callId=0;var push=[].push;var slice=Array.prototype.slice;if(!sinon&&commonJSModule){sinon=require("../sinon")}if(!sinon){return}sinon.extend(spy,function(){function delegateToCalls(e,t,n,r,i){e[t]=function(){if(!this.called){if(i){return i.apply(this,arguments)}return false}var e;var s=0;for(var o=0,u=this.callCount;o<u;o+=1){e=this.getCall(o);if(e[r||t].apply(e,arguments)){s+=1;if(n){return true}}}return s===this.callCount}}function matchingFake(e,t,n){if(!e){return}var r=t.length;for(var i=0,s=e.length;i<s;i++){if(e[i].matches(t,n)){return e[i]}}}function incrementCallCount(){this.called=true;this.callCount+=1;this.notCalled=false;this.calledOnce=this.callCount==1;this.calledTwice=this.callCount==2;this.calledThrice=this.callCount==3}function createCallProperties(){this.firstCall=this.getCall(0);this.secondCall=this.getCall(1);this.thirdCall=this.getCall(2);this.lastCall=this.getCall(this.callCount-1)}function createProxy(func){var p;if(func.length){eval("p = (function proxy("+vars.substring(0,func.length*2-1)+") { return p.invoke(func, this, slice.call(arguments)); });")}else{p=function(){return p.invoke(func,this,slice.call(arguments))}}return p}var vars="a,b,c,d,e,f,g,h,i,j,k,l";var uuid=0;var spyApi={reset:function(){this.called=false;this.notCalled=true;this.calledOnce=false;this.calledTwice=false;this.calledThrice=false;this.callCount=0;this.firstCall=null;this.secondCall=null;this.thirdCall=null;this.lastCall=null;this.args=[];this.returnValues=[];this.thisValues=[];this.exceptions=[];this.callIds=[];if(this.fakes){for(var e=0;e<this.fakes.length;e++){this.fakes[e].reset()}}},create:function(t){var n;if(typeof t!="function"){t=function(){}}else{n=sinon.functionName(t)}var r=createProxy(t);sinon.extend(r,spy);delete r.create;sinon.extend(r,t);r.reset();r.prototype=t.prototype;r.displayName=n||"spy";r.toString=sinon.functionToString;r._create=sinon.spy.create;r.id="spy#"+uuid++;return r},invoke:function(t,n,r){var i=matchingFake(this.fakes,r);var s,o;incrementCallCount.call(this);push.call(this.thisValues,n);push.call(this.args,r);push.call(this.callIds,callId++);try{if(i){o=i.invoke(t,n,r)}else{o=(this.func||t).apply(n,r)}}catch(u){push.call(this.returnValues,undefined);s=u;throw u}finally{push.call(this.exceptions,s)}push.call(this.returnValues,o);createCallProperties.call(this);return o},getCall:function(t){if(t<0||t>=this.callCount){return null}return spyCall.create(this,this.thisValues[t],this.args[t],this.returnValues[t],this.exceptions[t],this.callIds[t])},calledBefore:function(t){if(!this.called){return false}if(!t.called){return true}return this.callIds[0]<t.callIds[t.callIds.length-1]},calledAfter:function(t){if(!this.called||!t.called){return false}return this.callIds[this.callCount-1]>t.callIds[t.callCount-1]},withArgs:function(){var e=slice.call(arguments);if(this.fakes){var t=matchingFake(this.fakes,e,true);if(t){return t}}else{this.fakes=[]}var n=this;var r=this._create();r.matchingAguments=e;push.call(this.fakes,r);r.withArgs=function(){return n.withArgs.apply(n,arguments)};for(var i=0;i<this.args.length;i++){if(r.matches(this.args[i])){incrementCallCount.call(r);push.call(r.thisValues,this.thisValues[i]);push.call(r.args,this.args[i]);push.call(r.returnValues,this.returnValues[i]);push.call(r.exceptions,this.exceptions[i]);push.call(r.callIds,this.callIds[i])}}createCallProperties.call(r);return r},matches:function(e,t){var n=this.matchingAguments;if(n.length<=e.length&&sinon.deepEqual(n,e.slice(0,n.length))){return!t||n.length==e.length}},printf:function(e){var t=this;var n=slice.call(arguments,1);var r;return(e||"").replace(/%(.)/g,function(e,i){r=spyApi.formatters[i];if(typeof r=="function"){return r.call(null,t,n)}else if(!isNaN(parseInt(i),10)){return sinon.format(n[i-1])}return"%"+i})}};delegateToCalls(spyApi,"calledOn",true);delegateToCalls(spyApi,"alwaysCalledOn",false,"calledOn");delegateToCalls(spyApi,"calledWith",true);delegateToCalls(spyApi,"calledWithMatch",true);delegateToCalls(spyApi,"alwaysCalledWith",false,"calledWith");delegateToCalls(spyApi,"alwaysCalledWithMatch",false,"calledWithMatch");delegateToCalls(spyApi,"calledWithExactly",true);delegateToCalls(spyApi,"alwaysCalledWithExactly",false,"calledWithExactly");delegateToCalls(spyApi,"neverCalledWith",false,"notCalledWith",function(){return true});delegateToCalls(spyApi,"neverCalledWithMatch",false,"notCalledWithMatch",function(){return true});delegateToCalls(spyApi,"threw",true);delegateToCalls(spyApi,"alwaysThrew",false,"threw");delegateToCalls(spyApi,"returned",true);delegateToCalls(spyApi,"alwaysReturned",false,"returned");delegateToCalls(spyApi,"calledWithNew",true);delegateToCalls(spyApi,"alwaysCalledWithNew",false,"calledWithNew");delegateToCalls(spyApi,"callArg",false,"callArgWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")});spyApi.callArgWith=spyApi.callArg;delegateToCalls(spyApi,"yield",false,"yield",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")});spyApi.invokeCallback=spyApi.yield;delegateToCalls(spyApi,"yieldTo",false,"yieldTo",function(e){throw new Error(this.toString()+" cannot yield to '"+e+"' since it was not yet invoked.")});spyApi.formatters={c:function(e){return sinon.timesInWords(e.callCount)},n:function(e){return e.toString()},C:function(e){var t=[];for(var n=0,r=e.callCount;n<r;++n){push.call(t,"    "+e.getCall(n).toString())}return t.length>0?"\n"+t.join("\n"):""},t:function(e){var t=[];for(var n=0,r=e.callCount;n<r;++n){push.call(t,sinon.format(e.thisValues[n]))}return t.join(", ")},"*":function(e,t){var n=[];for(var r=0,i=t.length;r<i;++r){push.call(n,sinon.format(t[r]))}return n.join(", ")}};return spyApi}());spyCall=function(){function e(e,t,n){var r=sinon.functionName(e)+t;if(n.length){r+=" Received ["+slice.call(n).join(", ")+"]"}throw new Error(r)}var t={create:function(t,n,r,i,s,o){var u=sinon.create(spyCall);delete u.create;u.proxy=t;u.thisValue=n;u.args=r;u.returnValue=i;u.exception=s;u.callId=typeof o=="number"&&o||callId++;return u},calledOn:function(t){if(sinon.match&&sinon.match.isMatcher(t)){return t.test(this.thisValue)}return this.thisValue===t},calledWith:function(){for(var t=0,n=arguments.length;t<n;t+=1){if(!sinon.deepEqual(arguments[t],this.args[t])){return false}}return true},calledWithMatch:function(){for(var t=0,n=arguments.length;t<n;t+=1){var r=this.args[t];var i=arguments[t];if(!sinon.match||!sinon.match(i).test(r)){return false}}return true},calledWithExactly:function(){return arguments.length==this.args.length&&this.calledWith.apply(this,arguments)},notCalledWith:function(){return!this.calledWith.apply(this,arguments)},notCalledWithMatch:function(){return!this.calledWithMatch.apply(this,arguments)},returned:function(t){return sinon.deepEqual(t,this.returnValue)},threw:function(t){if(typeof t=="undefined"||!this.exception){return!!this.exception}if(typeof t=="string"){return this.exception.name==t}return this.exception===t},calledWithNew:function(t){return this.thisValue instanceof this.proxy},calledBefore:function(e){return this.callId<e.callId},calledAfter:function(e){return this.callId>e.callId},callArg:function(e){this.args[e]()},callArgWith:function(e){var t=slice.call(arguments,1);this.args[e].apply(null,t)},yield:function(){var t=this.args;for(var n=0,r=t.length;n<r;++n){if(typeof t[n]==="function"){t[n].apply(null,slice.call(arguments));return}}e(this.proxy," cannot yield since no callback was passed.",t)},yieldTo:function(t){var n=this.args;for(var r=0,i=n.length;r<i;++r){if(n[r]&&typeof n[r][t]==="function"){n[r][t].apply(null,slice.call(arguments,1));return}}e(this.proxy," cannot yield to '"+t+"' since no callback was passed.",n)},toString:function(){var e=this.proxy.toString()+"(";var t=[];for(var n=0,r=this.args.length;n<r;++n){push.call(t,sinon.format(this.args[n]))}e=e+t.join(", ")+")";if(typeof this.returnValue!="undefined"){e+=" => "+sinon.format(this.returnValue)}if(this.exception){e+=" !"+this.exception.name;if(this.exception.message){e+="("+this.exception.message+")"}}return e}};t.invokeCallback=t.yield;return t}();spy.spyCall=spyCall;sinon.spyCall=spyCall;if(commonJSModule){module.exports=spy}else{sinon.spy=spy}})(typeof sinon=="object"&&sinon||null);(function(e){function n(t,r,i){if(!!i&&typeof i!="function"){throw new TypeError("Custom stub should be function")}var s;if(i){s=e.spy&&e.spy.create?e.spy.create(i):i}else{s=n.create()}if(!t&&!r){return e.stub.create()}if(!r&&!!t&&typeof t=="object"){for(var o in t){if(typeof t[o]==="function"){n(t,o)}}return t}return e.wrapMethod(t,r,s)}function r(e,t){var n=e.callCount-1;var r=n in e[t]?e[t][n]:e[t+"Last"];e[t+"Last"]=r;return r}function i(e,t){var n=r(e,"callArgAts");if(n<0){var i=r(e,"callArgProps");for(var s=0,o=t.length;s<o;++s){if(!i&&typeof t[s]=="function"){return t[s]}if(i&&t[s]&&typeof t[s][i]=="function"){return t[s][i]}}return null}return t[n]}function o(t,n,r){if(t.callArgAtsLast<0){var i;if(t.callArgPropsLast){i=e.functionName(t)+" expected to yield to '"+t.callArgPropsLast+"', but no object with such a property was passed."}else{i=e.functionName(t)+" expected to yield, but no callback was passed."}if(r.length>0){i+=" Received ["+s.call(r,", ")+"]"}return i}return"argument at index "+t.callArgAtsLast+" is not a function: "+n}function a(e,t){if(e.callArgAts.length>0){var n=i(e,t);if(typeof n!="function"){throw new TypeError(o(e,n,t))}var s=e.callCount-1;var a=r(e,"callbackArguments");var f=r(e,"callbackContexts");if(e.callbackAsync){u(function(){n.apply(f,a)})}else{n.apply(f,a)}}}var t=typeof module=="object"&&typeof require=="function";if(!e&&t){e=require("../sinon")}if(!e){return}var s=Array.prototype.join;var u=function(){if(typeof process==="object"&&typeof process.nextTick==="function"){return process.nextTick}else if(typeof msSetImmediate==="function"){return msSetImmediate.bind(window)}else if(typeof setImmediate==="function"){return setImmediate}else{return function(e){setTimeout(e,0)}}}();var f=0;e.extend(n,function(){function i(e,t){if(typeof e=="string"){this.exception=new Error(t||"");this.exception.name=e}else if(!e){this.exception=new Error("Error")}else{this.exception=e}return this}var t=Array.prototype.slice,r;r={create:function(){var r=function(){a(r,arguments);if(r.exception){throw r.exception}else if(typeof r.returnArgAt=="number"){return arguments[r.returnArgAt]}else if(r.returnThis){return this}return r.returnValue};r.id="stub#"+f++;var i=r;r=e.spy.create(r);r.func=i;r.callArgAts=[];r.callbackArguments=[];r.callbackContexts=[];r.callArgProps=[];e.extend(r,n);r._create=e.stub.create;r.displayName="stub";r.toString=e.functionToString;return r},returns:function(t){this.returnValue=t;return this},returnsArg:function(t){if(typeof t!="number"){throw new TypeError("argument index is not number")}this.returnArgAt=t;return this},returnsThis:function(){this.returnThis=true;return this},"throws":i,throwsException:i,callsArg:function(t){if(typeof t!="number"){throw new TypeError("argument index is not number")}this.callArgAts.push(t);this.callbackArguments.push([]);this.callbackContexts.push(undefined);this.callArgProps.push(undefined);return this},callsArgOn:function(t,n){if(typeof t!="number"){throw new TypeError("argument index is not number")}if(typeof n!="object"){throw new TypeError("argument context is not an object")}this.callArgAts.push(t);this.callbackArguments.push([]);this.callbackContexts.push(n);this.callArgProps.push(undefined);return this},callsArgWith:function(n){if(typeof n!="number"){throw new TypeError("argument index is not number")}this.callArgAts.push(n);this.callbackArguments.push(t.call(arguments,1));this.callbackContexts.push(undefined);this.callArgProps.push(undefined);return this},callsArgOnWith:function(n,r){if(typeof n!="number"){throw new TypeError("argument index is not number")}if(typeof r!="object"){throw new TypeError("argument context is not an object")}this.callArgAts.push(n);this.callbackArguments.push(t.call(arguments,2));this.callbackContexts.push(r);this.callArgProps.push(undefined);return this},yields:function(){this.callArgAts.push(-1);this.callbackArguments.push(t.call(arguments,0));this.callbackContexts.push(undefined);this.callArgProps.push(undefined);return this},yieldsOn:function(e){if(typeof e!="object"){throw new TypeError("argument context is not an object")}this.callArgAts.push(-1);this.callbackArguments.push(t.call(arguments,1));this.callbackContexts.push(e);this.callArgProps.push(undefined);return this},yieldsTo:function(e){this.callArgAts.push(-1);this.callbackArguments.push(t.call(arguments,1));this.callbackContexts.push(undefined);this.callArgProps.push(e);return this},yieldsToOn:function(e,n){if(typeof n!="object"){throw new TypeError("argument context is not an object")}this.callArgAts.push(-1);this.callbackArguments.push(t.call(arguments,2));this.callbackContexts.push(n);this.callArgProps.push(e);return this}};for(var s in r){if(r.hasOwnProperty(s)&&s.match(/^(callsArg|yields|thenYields$)/)&&!s.match(/Async/)){r[s+"Async"]=function(e){return function(){this.callbackAsync=true;return this[e].apply(this,arguments)}}(s)}}return r}());if(t){module.exports=n}else{e.stub=n}})(typeof sinon=="object"&&sinon||null);(function(e){function r(t){if(!t){return e.expectation.create("Anonymous mock")}return r.create(t)}var t=typeof module=="object"&&typeof require=="function";var n=[].push;if(!e&&t){e=require("../sinon")}if(!e){return}e.mock=r;e.extend(r,function(){function t(e,t){if(!e){return}for(var n=0,r=e.length;n<r;n+=1){t(e[n])}}return{create:function(n){if(!n){throw new TypeError("object is null")}var i=e.extend({},r);i.object=n;delete i.create;return i},expects:function(r){if(!r){throw new TypeError("method is falsy")}if(!this.expectations){this.expectations={};this.proxies=[]}if(!this.expectations[r]){this.expectations[r]=[];var i=this;e.wrapMethod(this.object,r,function(){return i.invokeMethod(r,this,arguments)});n.call(this.proxies,r)}var s=e.expectation.create(r);n.call(this.expectations[r],s);return s},restore:function(){var n=this.object;t(this.proxies,function(e){if(typeof n[e].restore=="function"){n[e].restore()}})},verify:function(){var i=this.expectations||{};var s=[],o=[];t(this.proxies,function(e){t(i[e],function(e){if(!e.met()){n.call(s,e.toString())}else{n.call(o,e.toString())}})});this.restore();if(s.length>0){e.expectation.fail(s.concat(o).join("\n"))}else{e.expectation.pass(s.concat(o).join("\n"))}return true},invokeMethod:function(r,i,s){var o=this.expectations&&this.expectations[r];var u=o&&o.length||0,a;for(a=0;a<u;a+=1){if(!o[a].met()&&o[a].allowsCall(i,s)){return o[a].apply(i,s)}}var f=[],l,c=0;for(a=0;a<u;a+=1){if(o[a].allowsCall(i,s)){l=l||o[a]}else{c+=1}n.call(f,"    "+o[a].toString())}if(c===0){return l.apply(i,s)}f.unshift("Unexpected call: "+e.spyCall.toString.call({proxy:r,args:s}));e.expectation.fail(f.join("\n"))}}}());var i=e.timesInWords;e.expectation=function(){function s(e){if(e==0){return"never called"}else{return"called "+i(e)}}function o(e){var t=e.minCalls;var n=e.maxCalls;if(typeof t=="number"&&typeof n=="number"){var r=i(t);if(t!=n){r="at least "+r+" and at most "+i(n)}return r}if(typeof t=="number"){return"at least "+i(t)}return"at most "+i(n)}function u(e){var t=typeof e.minCalls=="number";return!t||e.callCount>=e.minCalls}function a(e){if(typeof e.maxCalls!="number"){return false}return e.callCount==e.maxCalls}var t=Array.prototype.slice;var r=e.spy.invoke;return{minCalls:1,maxCalls:1,create:function(n){var r=e.extend(e.stub.create(),e.expectation);delete r.create;r.method=n;return r},invoke:function(t,n,i){this.verifyCallAllowed(n,i);return r.apply(this,arguments)},atLeast:function(t){if(typeof t!="number"){throw new TypeError("'"+t+"' is not number")}if(!this.limitsSet){this.maxCalls=null;this.limitsSet=true}this.minCalls=t;return this},atMost:function(t){if(typeof t!="number"){throw new TypeError("'"+t+"' is not number")}if(!this.limitsSet){this.minCalls=null;this.limitsSet=true}this.maxCalls=t;return this},never:function(){return this.exactly(0)},once:function(){return this.exactly(1)},twice:function(){return this.exactly(2)},thrice:function(){return this.exactly(3)},exactly:function(t){if(typeof t!="number"){throw new TypeError("'"+t+"' is not a number")}this.atLeast(t);return this.atMost(t)},met:function(){return!this.failed&&u(this)},verifyCallAllowed:function(n,r){if(a(this)){this.failed=true;e.expectation.fail(this.method+" already called "+i(this.maxCalls))}if("expectedThis"in this&&this.expectedThis!==n){e.expectation.fail(this.method+" called with "+n+" as thisValue, expected "+this.expectedThis)}if(!("expectedArguments"in this)){return}if(!r){e.expectation.fail(this.method+" received no arguments, expected "+e.format(this.expectedArguments))}if(r.length<this.expectedArguments.length){e.expectation.fail(this.method+" received too few arguments ("+e.format(r)+"), expected "+e.format(this.expectedArguments))}if(this.expectsExactArgCount&&r.length!=this.expectedArguments.length){e.expectation.fail(this.method+" received too many arguments ("+e.format(r)+"), expected "+e.format(this.expectedArguments))}for(var s=0,o=this.expectedArguments.length;s<o;s+=1){if(!e.deepEqual(this.expectedArguments[s],r[s])){e.expectation.fail(this.method+" received wrong arguments "+e.format(r)+", expected "+e.format(this.expectedArguments))}}},allowsCall:function(n,r){if(this.met()&&a(this)){return false}if("expectedThis"in this&&this.expectedThis!==n){return false}if(!("expectedArguments"in this)){return true}r=r||[];if(r.length<this.expectedArguments.length){return false}if(this.expectsExactArgCount&&r.length!=this.expectedArguments.length){return false}for(var i=0,s=this.expectedArguments.length;i<s;i+=1){if(!e.deepEqual(this.expectedArguments[i],r[i])){return false}}return true},withArgs:function(){this.expectedArguments=t.call(arguments);return this},withExactArgs:function(){this.withArgs.apply(this,arguments);this.expectsExactArgCount=true;return this},on:function(t){this.expectedThis=t;return this},toString:function(){var t=(this.expectedArguments||[]).slice();if(!this.expectsExactArgCount){n.call(t,"[...]")}var r=e.spyCall.toString.call({proxy:this.method,args:t});var i=r.replace(", [...","[, ...")+" "+o(this);if(this.met()){return"Expectation met: "+i}return"Expected "+i+" ("+s(this.callCount)+")"},verify:function(){if(!this.met()){e.expectation.fail(this.toString())}else{e.expectation.pass(this.toString())}return true},pass:function(t){e.assert.pass(t)},fail:function(e){var t=new Error(e);t.name="ExpectationError";throw t}}}();if(t){module.exports=r}else{e.mock=r}})(typeof sinon=="object"&&sinon||null);(function(e){function i(e){if(!e.fakes){e.fakes=[]}return e.fakes}function s(e,t){var n=i(e);for(var r=0,s=n.length;r<s;r+=1){if(typeof n[r][t]=="function"){n[r][t]()}}}function o(e){var t=i(e);var n=0;while(n<t.length){t.splice(n,1)}}var t=typeof module=="object"&&typeof require=="function";var n=[].push;var r=Object.prototype.hasOwnProperty;if(!e&&t){e=require("../sinon")}if(!e){return}var u={verify:function(){s(this,"verify")},restore:function(){s(this,"restore");o(this)},verifyAndRestore:function(){var t;try{this.verify()}catch(n){t=n}this.restore();if(t){throw t}},add:function(t){n.call(i(this),t);return t},spy:function(){return this.add(e.spy.apply(e,arguments))},stub:function(n,i,s){if(i){var o=n[i];if(typeof o!="function"){if(!r.call(n,i)){throw new TypeError("Cannot stub non-existent own property "+i)}n[i]=s;return this.add({restore:function(){n[i]=o}})}}if(!i&&!!n&&typeof n=="object"){var u=e.stub.apply(e,arguments);for(var a in u){if(typeof u[a]==="function"){this.add(u[a])}}return u}return this.add(e.stub.apply(e,arguments))},mock:function(){return this.add(e.mock.apply(e,arguments))},inject:function(t){var n=this;t.spy=function(){return n.spy.apply(n,arguments)};t.stub=function(){return n.stub.apply(n,arguments)};t.mock=function(){return n.mock.apply(n,arguments)};return t}};if(t){module.exports=u}else{e.collection=u}})(typeof sinon=="object"&&sinon||null);if(typeof sinon=="undefined"){var sinon={}}(function(global){function addTimer(e,t){if(e.length===0){throw new Error("Function requires at least 1 parameter")}var n=id++;var r=e[1]||0;if(!this.timeouts){this.timeouts={}}this.timeouts[n]={id:n,func:e[0],callAt:this.now+r,invokeArgs:Array.prototype.slice.call(e,2)};if(t===true){this.timeouts[n].interval=r}return n}function parseTime(e){if(!e){return 0}var t=e.split(":");var n=t.length,r=n;var i=0,s;if(n>3||!/^(\d\d:){0,2}\d\d?$/.test(e)){throw new Error("tick only understands numbers and 'h:m:s'")}while(r--){s=parseInt(t[r],10);if(s>=60){throw new Error("Invalid time "+e)}i+=s*Math.pow(60,n-r-1)}return i*1e3}function createObject(e){var t;if(Object.create){t=Object.create(e)}else{var n=function(){};n.prototype=e;t=new n}t.Date.clock=t;return t}function mirrorDateProperties(e,t){if(t.now){e.now=function(){return e.clock.now}}else{delete e.now}if(t.toSource){e.toSource=function(){return t.toSource()}}else{delete e.toSource}e.toString=function n(){return t.toString()};e.prototype=t.prototype;e.parse=t.parse;e.UTC=t.UTC;e.prototype.toUTCString=t.prototype.toUTCString;return e}function restore(){var e;for(var t=0,n=this.methods.length;t<n;t++){e=this.methods[t];if(global[e].hadOwnProperty){global[e]=this["_"+e]}else{delete global[e]}}this.methods=[]}function stubGlobal(e,t){t[e].hadOwnProperty=Object.prototype.hasOwnProperty.call(global,e);t["_"+e]=global[e];if(e=="Date"){var n=mirrorDateProperties(t[e],global[e]);global[e]=n}else{global[e]=function(){return t[e].apply(t,arguments)};for(var r in t[e]){if(t[e].hasOwnProperty(r)){global[e][r]=t[e][r]}}}global[e].clock=t}var id=1;sinon.clock={now:0,create:function(t){var n=createObject(this);if(typeof t=="number"){n.now=t}if(!!t&&typeof t=="object"){throw new TypeError("now should be milliseconds since UNIX epoch")}return n},setTimeout:function(t,n){return addTimer.call(this,arguments,false)},clearTimeout:function(t){if(!this.timeouts){this.timeouts=[]}if(t in this.timeouts){delete this.timeouts[t]}},setInterval:function(t,n){return addTimer.call(this,arguments,true)},clearInterval:function(t){this.clearTimeout(t)},tick:function(t){t=typeof t=="number"?t:parseTime(t);var n=this.now,r=this.now+t,i=this.now;var s=this.firstTimerInRange(n,r);var o;while(s&&n<=r){if(this.timeouts[s.id]){n=this.now=s.callAt;try{this.callTimer(s)}catch(u){o=o||u}}s=this.firstTimerInRange(i,r);i=n}this.now=r;if(o){throw o}},firstTimerInRange:function(e,t){var n,r,i;for(var s in this.timeouts){if(this.timeouts.hasOwnProperty(s)){if(this.timeouts[s].callAt<e||this.timeouts[s].callAt>t){continue}if(!r||this.timeouts[s].callAt<r){i=this.timeouts[s];r=this.timeouts[s].callAt;n={func:this.timeouts[s].func,callAt:this.timeouts[s].callAt,interval:this.timeouts[s].interval,id:this.timeouts[s].id,invokeArgs:this.timeouts[s].invokeArgs}}}}return n||null},callTimer:function(timer){if(typeof timer.interval=="number"){this.timeouts[timer.id].callAt+=timer.interval}else{delete this.timeouts[timer.id]}try{if(typeof timer.func=="function"){timer.func.apply(null,timer.invokeArgs)}else{eval(timer.func)}}catch(e){var exception=e}if(!this.timeouts[timer.id]){if(exception){throw exception}return}if(exception){throw exception}},reset:function(){this.timeouts={}},Date:function(){function t(n,r,i,s,o,u,a){switch(arguments.length){case 0:return new e(t.clock.now);case 1:return new e(n);case 2:return new e(n,r);case 3:return new e(n,r,i);case 4:return new e(n,r,i,s);case 5:return new e(n,r,i,s,o);case 6:return new e(n,r,i,s,o,u);default:return new e(n,r,i,s,o,u,a)}}var e=Date;return mirrorDateProperties(t,e)}()};var methods=["Date","setTimeout","setInterval","clearTimeout","clearInterval"];sinon.useFakeTimers=function(t){var n=sinon.clock.create(t);n.restore=restore;n.methods=Array.prototype.slice.call(arguments,typeof t=="number"?1:0);if(n.methods.length===0){n.methods=methods}for(var r=0,i=n.methods.length;r<i;r++){stubGlobal(n.methods[r],n)}return n}})(typeof global!="undefined"&&typeof global!=="function"?global:this);sinon.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval,Date:Date};if(typeof module=="object"&&typeof require=="function"){module.exports=sinon}if(typeof sinon=="undefined"){this.sinon={}}(function(){var e=[].push;sinon.Event=function(t,n,r){this.initEvent(t,n,r)};sinon.Event.prototype={initEvent:function(e,t,n){this.type=e;this.bubbles=t;this.cancelable=n},stopPropagation:function(){},preventDefault:function(){this.defaultPrevented=true}};sinon.EventTarget={addEventListener:function(n,r,i){this.eventListeners=this.eventListeners||{};this.eventListeners[n]=this.eventListeners[n]||[];e.call(this.eventListeners[n],r)},removeEventListener:function(t,n,r){var i=this.eventListeners&&this.eventListeners[t]||[];for(var s=0,o=i.length;s<o;++s){if(i[s]==n){return i.splice(s,1)}}},dispatchEvent:function(t){var n=t.type;var r=this.eventListeners&&this.eventListeners[n]||[];for(var i=0;i<r.length;i++){if(typeof r[i]=="function"){r[i].call(this,t)}else{r[i].handleEvent(t)}}return!!t.defaultPrevented}}})();if(typeof sinon=="undefined"){this.sinon={}}sinon.xhr={XMLHttpRequest:this.XMLHttpRequest};(function(e){function r(){this.readyState=r.UNSENT;this.requestHeaders={};this.requestBody=null;this.status=0;this.statusText="";if(typeof r.onCreate=="function"){r.onCreate(this)}}function i(e){if(e.readyState!==r.OPENED){throw new Error("INVALID_STATE_ERR")}if(e.sendFlag){throw new Error("INVALID_STATE_ERR")}}function s(e,t){if(!e)return;for(var n=0,r=e.length;n<r;n+=1){t(e[n])}}function o(e,t){for(var n=0;n<e.length;n++){if(t(e[n])===true)return true}return false}function f(e){if(e.readyState==r.DONE){throw new Error("Request done")}}function l(e){if(e.async&&e.readyState!=r.HEADERS_RECEIVED){throw new Error("No headers received")}}function c(e){if(typeof e!="string"){var t=new Error("Attempted to respond to fake XMLHttpRequest with "+e+", which is not a string.");t.name="InvalidBodyException";throw t}}var t=sinon.xhr;t.GlobalXMLHttpRequest=e.XMLHttpRequest;t.GlobalActiveXObject=e.ActiveXObject;t.supportsActiveX=typeof t.GlobalActiveXObject!="undefined";t.supportsXHR=typeof t.GlobalXMLHttpRequest!="undefined";t.workingXHR=t.supportsXHR?t.GlobalXMLHttpRequest:t.supportsActiveX?function(){return new t.GlobalActiveXObject("MSXML2.XMLHTTP.3.0")}:false;var n={"Accept-Charset":true,"Accept-Encoding":true,Connection:true,"Content-Length":true,Cookie:true,Cookie2:true,"Content-Transfer-Encoding":true,Date:true,Expect:true,Host:true,"Keep-Alive":true,Referer:true,TE:true,Trailer:true,"Transfer-Encoding":true,Upgrade:true,"User-Agent":true,Via:true};var u=function(e,t,n){switch(n.length){case 0:return e[t]();case 1:return e[t](n[0]);case 2:return e[t](n[0],n[1]);case 3:return e[t](n[0],n[1],n[2]);case 4:return e[t](n[0],n[1],n[2],n[3]);case 5:return e[t](n[0],n[1],n[2],n[3],n[4])}};r.filters=[];r.addFilter=function(e){this.filters.push(e)};var a=/MSIE 6/;r.defake=function(e,t){var n=new sinon.xhr.workingXHR;s(["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","addEventListener","overrideMimeType","removeEventListener"],function(t){e[t]=function(){return u(n,t,arguments)}});var i=function(t){s(t,function(t){try{e[t]=n[t]}catch(r){if(!a.test(navigator.userAgent))throw r}})};var o=function(){e.readyState=n.readyState;if(n.readyState>=r.HEADERS_RECEIVED){i(["status","statusText"])}if(n.readyState>=r.LOADING){i(["responseText"])}if(n.readyState===r.DONE){i(["responseXML"])}if(e.onreadystatechange)e.onreadystatechange.call(e)};if(n.addEventListener){for(var f in e.eventListeners){if(e.eventListeners.hasOwnProperty(f)){s(e.eventListeners[f],function(e){n.addEventListener(f,e)})}}n.addEventListener("readystatechange",o)}else{n.onreadystatechange=o}u(n,"open",t)};r.useFilters=false;sinon.extend(r.prototype,sinon.EventTarget,{async:true,open:function(t,n,i,s,u){this.method=t;this.url=n;this.async=typeof i=="boolean"?i:true;this.username=s;this.password=u;this.responseText=null;this.responseXML=null;this.requestHeaders={};this.sendFlag=false;if(sinon.FakeXMLHttpRequest.useFilters===true){var a=arguments;var f=o(r.filters,function(e){return e.apply(this,a)});if(f){return sinon.FakeXMLHttpRequest.defake(this,arguments)}}this.readyStateChange(r.OPENED)},readyStateChange:function(t){this.readyState=t;if(typeof this.onreadystatechange=="function"){try{this.onreadystatechange()}catch(n){sinon.logError("Fake XHR onreadystatechange handler",n)}}this.dispatchEvent(new sinon.Event("readystatechange"))},setRequestHeader:function(t,r){i(this);if(n[t]||/^(Sec-|Proxy-)/.test(t)){throw new Error('Refused to set unsafe header "'+t+'"')}if(this.requestHeaders[t]){this.requestHeaders[t]+=","+r}else{this.requestHeaders[t]=r}},setResponseHeaders:function(t){this.responseHeaders={};for(var n in t){if(t.hasOwnProperty(n)){this.responseHeaders[n]=t[n]}}if(this.async){this.readyStateChange(r.HEADERS_RECEIVED)}},send:function(t){i(this);if(!/^(get|head)$/i.test(this.method)){if(this.requestHeaders["Content-Type"]){var n=this.requestHeaders["Content-Type"].split(";");this.requestHeaders["Content-Type"]=n[0]+";charset=utf-8"}else{this.requestHeaders["Content-Type"]="text/plain;charset=utf-8"}this.requestBody=t}this.errorFlag=false;this.sendFlag=this.async;this.readyStateChange(r.OPENED);if(typeof this.onSend=="function"){this.onSend(this)}},abort:function(){this.aborted=true;this.responseText=null;this.errorFlag=true;this.requestHeaders={};if(this.readyState>sinon.FakeXMLHttpRequest.UNSENT&&this.sendFlag){this.readyStateChange(sinon.FakeXMLHttpRequest.DONE);this.sendFlag=false}this.readyState=sinon.FakeXMLHttpRequest.UNSENT},getResponseHeader:function(t){if(this.readyState<r.HEADERS_RECEIVED){return null}if(/^Set-Cookie2?$/i.test(t)){return null}t=t.toLowerCase();for(var n in this.responseHeaders){if(n.toLowerCase()==t){return this.responseHeaders[n]}}return null},getAllResponseHeaders:function(){if(this.readyState<r.HEADERS_RECEIVED){return""}var t="";for(var n in this.responseHeaders){if(this.responseHeaders.hasOwnProperty(n)&&!/^Set-Cookie2?$/i.test(n)){t+=n+": "+this.responseHeaders[n]+"\r\n"}}return t},setResponseBody:function(t){f(this);l(this);c(t);var n=this.chunkSize||10;var i=0;this.responseText="";do{if(this.async){this.readyStateChange(r.LOADING)}this.responseText+=t.substring(i,i+n);i+=n}while(i<t.length);var s=this.getResponseHeader("Content-Type");if(this.responseText&&(!s||/(text\/xml)|(application\/xml)|(\+xml)/.test(s))){try{this.responseXML=r.parseXML(this.responseText)}catch(o){}}if(this.async){this.readyStateChange(r.DONE)}else{this.readyState=r.DONE}},respond:function(t,n,i){this.setResponseHeaders(n||{});this.status=typeof t=="number"?t:200;this.statusText=r.statusCodes[this.status];this.setResponseBody(i||"")}});sinon.extend(r,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});r.parseXML=function(t){var n;if(typeof DOMParser!="undefined"){var r=new DOMParser;n=r.parseFromString(t,"text/xml")}else{n=new ActiveXObject("Microsoft.XMLDOM");n.async="false";n.loadXML(t)}return n};r.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};sinon.useFakeXMLHttpRequest=function(){sinon.FakeXMLHttpRequest.restore=function(r){if(t.supportsXHR){e.XMLHttpRequest=t.GlobalXMLHttpRequest}if(t.supportsActiveX){e.ActiveXObject=t.GlobalActiveXObject}delete sinon.FakeXMLHttpRequest.restore;if(r!==true){delete sinon.FakeXMLHttpRequest.onCreate}};if(t.supportsXHR){e.XMLHttpRequest=sinon.FakeXMLHttpRequest}if(t.supportsActiveX){e.ActiveXObject=function(n){if(n=="Microsoft.XMLHTTP"||/^Msxml2\.XMLHTTP/i.test(n)){return new sinon.FakeXMLHttpRequest}return new t.GlobalActiveXObject(n)}}return sinon.FakeXMLHttpRequest};sinon.FakeXMLHttpRequest=r})(this);if(typeof module=="object"&&typeof require=="function"){module.exports=sinon}if(typeof sinon=="undefined"){var sinon={}}sinon.fakeServer=function(){function t(){}function n(e){t.prototype=e;return new t}function r(e){var t=e;if(Object.prototype.toString.call(e)!="[object Array]"){t=[200,{},e]}if(typeof t[2]!="string"){throw new TypeError("Fake server response body should be string, but was "+typeof t[2])}return t}function o(e,t,n){var r=e.method;var i=!r||r.toLowerCase()==t.toLowerCase();var s=e.url;var o=!s||s==n||typeof s.test=="function"&&s.test(n);return i&&o}function u(e,t){var n=this.getHTTPMethod(t);var r=t.url;if(!/^https?:\/\//.test(r)||s.test(r)){r=r.replace(s,"")}if(o(e,this.getHTTPMethod(t),r)){if(typeof e.response=="function"){var i=e.url;var u=[t].concat(!i?[]:r.match(i).slice(1));return e.response.apply(e,u)}return true}return false}var e=[].push;var i=typeof window!=="undefined"?window.location:{};var s=new RegExp("^"+i.protocol+"//"+i.host);return{create:function(){var e=n(this);this.xhr=sinon.useFakeXMLHttpRequest();e.requests=[];this.xhr.onCreate=function(t){e.addRequest(t)};return e},addRequest:function(n){var r=this;e.call(this.requests,n);n.onSend=function(){r.handleRequest(this)};if(this.autoRespond&&!this.responding){setTimeout(function(){r.responding=false;r.respond()},this.autoRespondAfter||10);this.responding=true}},getHTTPMethod:function(t){if(this.fakeHTTPMethods&&/post/i.test(t.method)){var n=(t.requestBody||"").match(/_method=([^\b;]+)/);return!!n?n[1]:t.method}return t.method},handleRequest:function(n){if(n.async){if(!this.queue){this.queue=[]}e.call(this.queue,n)}else{this.processRequest(n)}},respondWith:function(n,i,s){if(arguments.length==1&&typeof n!="function"){this.response=r(n);return}if(!this.responses){this.responses=[]}if(arguments.length==1){s=n;i=n=null}if(arguments.length==2){s=i;i=n;n=null}e.call(this.responses,{method:n,url:i,response:typeof s=="function"?s:r(s)})},respond:function(){if(arguments.length>0)this.respondWith.apply(this,arguments);var t=this.queue||[];var n;while(n=t.shift()){this.processRequest(n)}},processRequest:function(t){try{if(t.aborted){return}var n=this.response||[404,{},""];if(this.responses){for(var r=0,i=this.responses.length;r<i;r++){if(u.call(this,this.responses[r],t)){n=this.responses[r].response;break}}}if(t.readyState!=4){t.respond(n[0],n[1],n[2])}}catch(s){sinon.logError("Fake server request processing",s)}},restore:function(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}();if(typeof module=="object"&&typeof require=="function"){module.exports=sinon}(function(){function e(){}e.prototype=sinon.fakeServer;sinon.fakeServerWithClock=new e;sinon.fakeServerWithClock.addRequest=function(t){if(t.async){if(typeof setTimeout.clock=="object"){this.clock=setTimeout.clock}else{this.clock=sinon.useFakeTimers();this.resetClock=true}if(!this.longestTimeout){var n=this.clock.setTimeout;var r=this.clock.setInterval;var i=this;this.clock.setTimeout=function(e,t){i.longestTimeout=Math.max(t,i.longestTimeout||0);return n.apply(this,arguments)};this.clock.setInterval=function(e,t){i.longestTimeout=Math.max(t,i.longestTimeout||0);return r.apply(this,arguments)}}}return sinon.fakeServer.addRequest.call(this,t)};sinon.fakeServerWithClock.respond=function(){var t=sinon.fakeServer.respond.apply(this,arguments);if(this.clock){this.clock.tick(this.longestTimeout||0);this.longestTimeout=0;if(this.resetClock){this.clock.restore();this.resetClock=false}}return t};sinon.fakeServerWithClock.restore=function(){if(this.clock){this.clock.restore()}return sinon.fakeServer.restore.apply(this,arguments)}})();if(typeof module=="object"&&typeof require=="function"){var sinon=require("../sinon");sinon.extend(sinon,require("./util/fake_timers"))}(function(){function t(t,n,r,i){if(!i){return}if(n.injectInto){n.injectInto[r]=i}else{e.call(t.args,i)}}function n(e){var t=sinon.create(sinon.sandbox);if(e.useFakeServer){if(typeof e.useFakeServer=="object"){t.serverPrototype=e.useFakeServer}t.useFakeServer()}if(e.useFakeTimers){if(typeof e.useFakeTimers=="object"){t.useFakeTimers.apply(t,e.useFakeTimers)}else{t.useFakeTimers()}}return t}var e=[].push;sinon.sandbox=sinon.extend(sinon.create(sinon.collection),{useFakeTimers:function(){this.clock=sinon.useFakeTimers.apply(sinon,arguments);return this.add(this.clock)},serverPrototype:sinon.fakeServer,useFakeServer:function(){var t=this.serverPrototype||sinon.fakeServer;if(!t||!t.create){return null}this.server=t.create();return this.add(this.server)},inject:function(e){sinon.collection.inject.call(this,e);if(this.clock){e.clock=this.clock}if(this.server){e.server=this.server;e.requests=this.server.requests}return e},create:function(e){if(!e){return sinon.create(sinon.sandbox)}var r=n(e);r.args=r.args||[];var i,s,o=r.inject({});if(e.properties){for(var u=0,a=e.properties.length;u<a;u++){i=e.properties[u];s=o[i]||i=="sandbox"&&r;t(r,e,i,s)}}else{t(r,e,"sandbox",s)}return r}});sinon.sandbox.useFakeXMLHttpRequest=sinon.sandbox.useFakeServer;if(typeof module=="object"&&typeof require=="function"){module.exports=sinon.sandbox}})();(function(e){function n(t){var n=typeof t;if(n!="function"){throw new TypeError("sinon.test needs to wrap a test function, got "+n)}return function(){var n=e.getConfig(e.config);n.injectInto=n.injectIntoThis&&this||n.injectInto;var r=e.sandbox.create(n);var i,s;var o=Array.prototype.slice.call(arguments).concat(r.args);try{s=t.apply(this,o)}catch(u){i=u}if(typeof i!=="undefined"){r.restore();throw i}else{r.verifyAndRestore()}return s}}var t=typeof module=="object"&&typeof require=="function";if(!e&&t){e=require("../sinon")}if(!e){return}n.config={injectIntoThis:true,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:true,useFakeServer:true};if(t){module.exports=n}else{e.test=n}})(typeof sinon=="object"&&sinon||null);(function(e){function n(e,t,n){return function(){if(t){t.apply(this,arguments)}var r,i;try{i=e.apply(this,arguments)}catch(s){r=s}if(n){n.apply(this,arguments)}if(r){throw r}return i}}function r(t,r){if(!t||typeof t!="object"){throw new TypeError("sinon.testCase needs an object with test functions")}r=r||"test";var i=new RegExp("^"+r);var s={},o,u,a;var f=t.setUp;var l=t.tearDown;for(o in t){if(t.hasOwnProperty(o)){u=t[o];if(/^(setUp|tearDown)$/.test(o)){continue}if(typeof u=="function"&&i.test(o)){a=u;if(f||l){a=n(u,f,l)}s[o]=e.test(a)}else{s[o]=t[o]}}}return s}var t=typeof module=="object"&&typeof require=="function";if(!e&&t){e=require("../sinon")}if(!e||!Object.prototype.hasOwnProperty){return}if(t){module.exports=r}else{e.testCase=r}})(typeof sinon=="object"&&sinon||null);(function(e,t){function s(){var e;for(var t=0,n=arguments.length;t<n;++t){e=arguments[t];if(!e){i.fail("fake is not a spy")}if(typeof e!="function"){i.fail(e+" is not a function")}if(typeof e.getCall!="function"){i.fail(e+" is not stubbed")}}}function o(e,n){e=e||t;var r=e.fail||i.fail;r.call(e,n)}function u(e,t,n){if(arguments.length==2){n=t;t=e}i[e]=function(u){s(u);var a=r.call(arguments,1);var f=false;if(typeof t=="function"){f=!t(u)}else{f=typeof u[t]=="function"?!u[t].apply(u,a):!u[t]}if(f){o(this,u.printf.apply(u,[n].concat(a)))}else{i.pass(e)}}}function a(e,t){return!e||/^fail/.test(t)?t:e+t.slice(0,1).toUpperCase()+t.slice(1)}var n=typeof module=="object"&&typeof require=="function";var r=Array.prototype.slice;var i;if(!e&&n){e=require("../sinon")}if(!e){return}i={failException:"AssertError",fail:function(t){var n=new Error(t);n.name=this.failException||i.failException;throw n},pass:function(t){},callOrder:function(){s.apply(null,arguments);var n="",u="";if(!e.calledInOrder(arguments)){try{n=[].join.call(arguments,", ");u=e.orderByFirstCall(r.call(arguments)).join(", ")}catch(a){}o(this,"expected "+n+" to be "+"called in order but were called as "+u)}else{i.pass("callOrder")}},callCount:function(n,r){s(n);if(n.callCount!=r){var u="expected %n to be called "+e.timesInWords(r)+" but was called %c%C";o(this,n.printf(u))}else{i.pass("callCount")}},expose:function(t,n){if(!t){throw new TypeError("target is null or undefined")}var r=n||{};var i=typeof r.prefix=="undefined"&&"assert"||r.prefix;var s=typeof r.includeFail=="undefined"||!!r.includeFail;for(var o in this){if(o!="export"&&(s||!/^(fail)/.test(o))){t[a(i,o)]=this[o]}}return t}};u("called","expected %n to have been called at least once but was never called");u("notCalled",function(e){return!e.called},"expected %n to not have been called but was called %c%C");u("calledOnce","expected %n to be called once but was called %c%C");u("calledTwice","expected %n to be called twice but was called %c%C");u("calledThrice","expected %n to be called thrice but was called %c%C");u("calledOn","expected %n to be called with %1 as this but was called with %t");u("alwaysCalledOn","expected %n to always be called with %1 as this but was called with %t");u("calledWithNew","expected %n to be called with new");u("alwaysCalledWithNew","expected %n to always be called with new");u("calledWith","expected %n to be called with arguments %*%C");u("calledWithMatch","expected %n to be called with match %*%C");u("alwaysCalledWith","expected %n to always be called with arguments %*%C");u("alwaysCalledWithMatch","expected %n to always be called with match %*%C");u("calledWithExactly","expected %n to be called with exact arguments %*%C");u("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*%C");u("neverCalledWith","expected %n to never be called with arguments %*%C");u("neverCalledWithMatch","expected %n to never be called with match %*%C");u("threw","%n did not throw exception%C");u("alwaysThrew","%n did not always throw exception%C");if(n){module.exports=i}else{e.assert=i}})(typeof sinon=="object"&&sinon||null,typeof window!="undefined"?window:global);return sinon}.call(typeof window!="undefined"&&window||{})
